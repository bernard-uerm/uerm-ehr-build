"use strict";(self["webpackChunkehr"]=self["webpackChunkehr"]||[]).push([[64],{6817:(e,t,s)=>{s.d(t,{Z:()=>v});var a=s(3673),o=s(2323);const l={class:"column"},i=(0,a._)("div",{class:"row justify-center bg-blue-10"},null,-1),r={class:"row"},n=(0,a.Uk)(" UERM EMR / EHR "),u={key:0,class:"q-gutter-md"},h={key:1,class:"q-gutter-md"},d={class:"text-h5 text-weight-thin q-pt-md"};function c(e,t,s,c,g,p){const m=(0,a.up)("q-card-section"),w=(0,a.up)("q-fab-action"),b=(0,a.up)("q-fab"),f=(0,a.up)("q-input"),y=(0,a.up)("q-icon"),k=(0,a.up)("q-chip"),T=(0,a.up)("q-banner"),M=(0,a.up)("q-btn"),P=(0,a.up)("q-card-actions"),I=(0,a.up)("q-spinner"),q=(0,a.up)("q-inner-loading"),O=(0,a.up)("q-form"),L=(0,a.up)("q-card"),E=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(E,{class:"row justify-center items-center q-pa-sm"},{default:(0,a.w5)((()=>[(0,a._)("div",l,[i,(0,a._)("div",r,[(0,a.Wm)(L,{square:"",class:"shadow-1"},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{ref:"track",onSubmit:e.authenticate},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{class:"text-h5 text-white text-center text-weight-thin bg-blue-10",align:"center"},{default:(0,a.w5)((()=>[n])),_:1}),this.authLoading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(m,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{color:"blue-9",class:"absolute",style:{top:"0",transform:"translateY(-50%)"},icon:"fa fa-sign-in-alt",direction:"up","label-class":"bg-amber text-black","external-label":""},{default:(0,a.w5)((()=>["uermEmail"!==e.authMethod?((0,a.wg)(),(0,a.j4)(w,{key:0,color:"amber","external-label":"","label-class":"bg-amber text-black",label:"UERM Email","text-color":"black",onClick:t[0]||(t[0]=t=>e.changeAuthMethod("uermEmail")),icon:"ion-logo-google"})):(0,a.kq)("",!0),"otp"!==e.authMethod?((0,a.wg)(),(0,a.j4)(w,{key:1,color:"amber","external-label":"","label-class":"bg-amber text-black",label:"Mobile OTP",onClick:t[1]||(t[1]=t=>e.changeAuthMethod("otp")),"text-color":"black",icon:"ion-phone-portrait"})):(0,a.kq)("",!0),"uermPassword"!==e.authMethod?((0,a.wg)(),(0,a.j4)(w,{key:2,color:"amber","external-label":"","label-class":"bg-amber text-black",label:"UERM Credentials","text-color":"black",onClick:t[2]||(t[2]=t=>e.changeAuthMethod("uermPassword")),icon:"ion-lock"})):(0,a.kq)("",!0)])),_:1})])),_:1})),this.authLoading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(m,{key:1},{default:(0,a.w5)((()=>["uermPassword"===e.authMethod?((0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(f,{square:"",filled:"",clearable:"",modelValue:e.loginInfo.employeeCode,"onUpdate:modelValue":t[3]||(t[3]=t=>e.loginInfo.employeeCode=t),type:"text",label:"Employee ID",autofocus:e.loginFocus,rules:[e=>!!e||"Field is required"]},null,8,["modelValue","autofocus","rules"]),(0,a.Wm)(f,{square:"",filled:"",clearable:"",modelValue:e.loginInfo.password,"onUpdate:modelValue":t[5]||(t[5]=t=>e.loginInfo.password=t),label:"Password",type:e.isPwd?"password":"text",rules:[e=>!!e||"Field is required"]},{append:(0,a.w5)((()=>[(0,a.Wm)(y,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[4]||(t[4]=t=>e.isPwd=!e.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type","rules"])])):"otp"===e.authMethod?((0,a.wg)(),(0,a.iD)("div",h,[e.showOTP?((0,a.wg)(),(0,a.j4)(f,{key:1,square:"",filled:"",clearable:"",modelValue:e.loginInfo.otp,"onUpdate:modelValue":t[7]||(t[7]=t=>e.loginInfo.otp=t),type:"number",label:"OTP",maxlength:"6",autofocus:e.otpValidateFocus,rules:[e=>6==e.length||"Please enter maximum 6 characters"]},null,8,["modelValue","autofocus","rules"])):((0,a.wg)(),(0,a.j4)(f,{key:0,prefix:"+63",square:"",filled:"",clearable:"",modelValue:e.loginInfo.mobileNumber,"onUpdate:modelValue":t[6]||(t[6]=t=>e.loginInfo.mobileNumber=t),type:"number",label:"Mobile Number",maxlength:"9",autofocus:e.otpFocus,rules:[e=>10==e.length||"Please enter maximum 10 characters",e=>!!e||"Field is required"]},null,8,["modelValue","autofocus","rules"]))])):(0,a.kq)("",!0)])),_:1})),"otp"===e.authMethod&&e.showOTP?((0,a.wg)(),(0,a.j4)(m,{key:2,class:"q-pt-none",align:"center"},{default:(0,a.w5)((()=>[e.authLoading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(k,{key:0,clickable:"",disable:e.disableResendOTP,onClick:e.resendOTP,color:"blue-10","text-color":"white",icon:"ion-send"},{default:(0,a.w5)((()=>[(0,a.Uk)(" RESEND OTP"+(0,o.zw)(0===e.countDown?"":" IN "+e.countDown+" secs"),1)])),_:1},8,["disable","onClick"]))])),_:1})):(0,a.kq)("",!0),null!==e.errorMessage?((0,a.wg)(),(0,a.j4)(m,{key:3,class:"q-py-none",align:"center"},{default:(0,a.w5)((()=>[e.authLoading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(T,{key:0,class:(0,o.C_)(["error"===e.errorType?"bg-red text-white":"bg-orange text-black"])},{avatar:(0,a.w5)((()=>[(0,a.Wm)(y,{name:"ion-alert",color:"error"===e.errorType?"white":"black"},null,8,["color"])])),default:(0,a.w5)((()=>[(0,a.Uk)(" "+(0,o.zw)(e.errorMessage),1)])),_:1},8,["class"]))])),_:1})):(0,a.kq)("",!0),this.authLoading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(P,{key:4,class:"q-px-md"},{default:(0,a.w5)((()=>["uermPassword"===e.authMethod?((0,a.wg)(),(0,a.j4)(M,{key:0,push:"",icon:"ion-lock",color:"blue-10",type:"submit",size:"lg",class:"full-width",label:"LOGIN"})):"otp"!==e.authMethod||e.showOTP?"otp"===e.authMethod&&e.showOTP?((0,a.wg)(),(0,a.j4)(M,{key:2,push:"",icon:"ion-phone-portrait",color:"blue-10",type:"submit",label:"VALIDATE",class:"full-width",size:"lg"})):((0,a.wg)(),(0,a.j4)(M,{key:3,push:"",color:"blue-10",type:"submit",icon:"ion-logo-google",size:"lg",class:"full-width",label:"LOGIN USING UERM GMAIL"})):((0,a.wg)(),(0,a.j4)(M,{key:1,push:"",icon:"ion-phone-portrait",color:"blue-10",type:"submit",size:"lg",class:"full-width",label:"GENERATE OTP"}))])),_:1})),(0,a.Wm)(q,{showing:this.authLoading},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{color:"primary",size:"3em",thickness:8})])),_:1},8,["showing"]),this.authLoading?((0,a.wg)(),(0,a.j4)(m,{key:5,style:{height:"200px"},class:"flex flex-center",align:"center"},{default:(0,a.w5)((()=>[(0,a._)("div",d,(0,o.zw)(e.loadingMessage),1)])),_:1})):(0,a.kq)("",!0)])),_:1},8,["onSubmit"])])),_:1})])])])),_:1})}var g=s(1959),p=s(3617),m=s(2471);const w=(0,a.aZ)({name:"Auth",data(){return{loginInfo:{employeeCode:null,password:null,mobileNumber:[],emailAddress:null,otp:[]},authMethod:"uermPassword",authLoading:!1,countDown:55,disableResendOTP:!0,loginFocus:!0,otpFocus:!1,otpValidateFocus:!1,loadingMessage:null,errorType:null,errorMessage:null}},setup(){const e=(0,a.f3)("Vue3GoogleOauth");return{Vue3GoogleOauth:e,isPwd:(0,g.iH)(!0)}},computed:{...(0,p.Se)({showOTP:"user/showOTP",userDetails:"user/userDetails",isLoggedIn:"user/isLoggedIn"})},watch:{countDown(e){0===e&&(this.disableResendOTP=!1)},authMethod(e){this.errorMessage=null,this.errorType=null,this.toggleOTP(!1),"otp"===e?this.otpFocus=!0:"uermPassword"===e&&(this.loginFocus=!0)},showOTP(e){e&&(this.otpValidateFocus=!0)},isLoggedIn(e){e&&this.redirect()}},mounted(){this.checkAuth()},methods:{async redirect(){this.$router.push("/")},async checkAuth(){const e=m.Z.get("isLoggedIn");e&&this.redirect()},async toggleOTP(e){await this.$store.dispatch("user/showOTP",e)},changeAuthMethod(e){this.loadingMessage="LOADING",this.authLoading=!0,this.authMethod=e,setTimeout((()=>{this.authLoading=!1}),1500)},authenticate(){"uermEmail"===this.authMethod?this.authenticateGoogle():"otp"===this.authMethod?this.showOTP?this.validateOTP():this.generateOTP():this.authenticateUERMCredentials()},async authenticateGoogle(){try{this.authLoading=!0,this.loadingMessage="AUTHENTICATING";const e=await this.$gAuth.signIn();if(!e)return null;const t=e.getBasicProfile().getEmail();this.loginInfo.emailAddress=t;const s=await this.validateUser(null),a={auth:!0,authMethod:"uermEmail",authDetails:e.getBasicProfile(),userDetails:this.userDetails};void 0!==s.error?(this.errorType="notice",this.errorMessage="UERM EMAIL IS INVALID!",this.authLoading=!1,this.loadingMessage=null):(this.errorType=null,this.errorMessage=null,this.authLoading=!1,this.loadingMessage=null,this.$store.dispatch("user/setLoginStatus",a),this.redirect())}catch(e){return console.error(e),this.errorType="error",this.errorMessage=`Error: ${e.error}`,this.authLoading=!1,this.loadingMessage=null,null}},async authenticateUERMCredentials(){this.loadingMessage="AUTHENTICATING",this.authLoading=!0;const e=await this.validateUser(null);"success"===e.message&&this.redirect(),this.authLoading=!1},async generateOTP(){this.loadingMessage="GENERATING OTP",this.authLoading=!0,await this.validateUser(null),this.countDownTimer(),this.authLoading=!1},async validateUser(e){const t=null!==this.loginInfo.mobileNumber?`0${this.loginInfo.mobileNumber}`:null,s={employeeCode:this.loginInfo.employeeCode,password:this.loginInfo.password,emailAddress:this.loginInfo.emailAddress,mobileNumber:t,authMethod:this.authMethod,authType:e},a=await this.$store.dispatch("user/validateUser",s);return a},async validateOTP(){this.loadingMessage="VALIDATING OTP",this.authLoading=!0;const e={otp:this.loginInfo.otp,userDetails:this.userDetails},t=await this.$store.dispatch("user/validateOTP",e);"error"===t.otpAuth?(this.errorType="notice",this.errorMessage="OTP ENTERED IS INCORRECT!"):(this.errorType=null,this.errorMessage=null,this.redirect())},async resendOTP(){this.loadingMessage="RESENDING OTP",this.authLoading=!0,this.errorType=null,this.errorMessage=null;const e=m.Z.get("uid"),t={userDetails:this.userDetails,token:e};await this.$store.dispatch("user/generateOTP",t),this.countDown=55,this.disableResendOTP=!0,this.countDownTimer(),this.authLoading=!1},countDownTimer(){this.countDown>0&&setTimeout((()=>{this.countDown-=1,this.countDownTimer()}),1e3)}}});var b=s(4260),f=s(4379),y=s(151),k=s(8689),T=s(5589),M=s(9200),P=s(9975),I=s(4842),q=s(4554),O=s(7030),L=s(5607),E=s(9367),x=s(8240),D=s(6941),A=s(9754),N=s(7518),C=s.n(N);const U=(0,b.Z)(w,[["render",c]]),v=U;C()(w,"components",{QPage:f.Z,QCard:y.Z,QForm:k.Z,QCardSection:T.Z,QFab:M.Z,QFabAction:P.Z,QInput:I.Z,QIcon:q.Z,QChip:O.Z,QBanner:L.Z,QCardActions:E.Z,QBtn:x.Z,QInnerLoading:D.Z,QSpinner:A.Z})}}]);